{"uid":"bb4cbba683069f3b","name":"test_createFacility_notSuperUser_returns400AndOnlySuperuserError[User.FACILITY_ADMIN]","fullName":"tests.facility.test_facility.TestFacilityAuth#test_createFacility_notSuperUser_returns400AndOnlySuperuserError","historyId":"f79c952e76ed9687b8f998c7e63da77d","time":{"start":1700620847189,"stop":1700620847189,"duration":0},"status":"broken","statusMessage":"AttributeError: 'NoneType' object has no attribute 'access'","statusTrace":"request = <SubRequest 'users' for <Function test_createFacility_notSuperUser_returns400AndOnlySuperuserError[User.FACILITY_ADMIN]>>\n\n    @pytest.fixture(autouse=True)\n    def users(request):\n        \"\"\"\n        Authorizes user request.\n    \n        Steps:\n            - Select user depending on `user` param value from core.enums.users.User.\n            - Get user credentials (email, password) using get_config_user()\n            - Request user token. And cache user token. Use cached value next time.\n        \"\"\"\n        client = request.session.client\n        user_type = request.node.callspec.params.get('user')  # Don't change `user`. You should change @users, and `user`\n        # param in tests if you change user here.\n    \n        if user_type is User.NONE:\n            # Remove Authorization header\n            client.remove_headers('Authorization')\n        else:\n            # Update headers with Authorization header\n            email, password = get_config_user(user_type)\n>           access_token = get_access_token(client, email, password)\n\ntests/conftest.py:60: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nclient = <core.http_client.HTTPClient object at 0x7fc08c9c7ed0>\nemail = 'aqa_test_user_robert49@example.com', password = '@4O@yI5LB5'\n\n    def get_access_token(client: HTTPClient, email: str, password: str) -> str:\n        access_token = CACHED_ACCESS_TOKENS.get(email)  # Check cache\n        is_cached_access_token_expired = True\n    \n        if access_token is not None:\n            is_cached_access_token_expired = is_jwt_expired(access_token)\n    \n        if access_token is None or is_cached_access_token_expired:\n            response, model = TokenAPI(client).login(email=email, password=password)\n>           access_token = model.data.access\nE           AttributeError: 'NoneType' object has no attribute 'access'\n\ncore/auth.py:17: AttributeError","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":3,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1700620097046,"stop":1700620097063,"duration":17},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"client","time":{"start":1700620097063,"stop":1700620097063,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false},{"name":"users","time":{"start":1700620847189,"stop":1700620847752,"duration":563},"status":"broken","statusMessage":"AttributeError: 'NoneType' object has no attribute 'access'\n","statusTrace":"  File \"/home/runner/.cache/pypoetry/virtualenvs/disney-test-api-taf-A9L5E0vM-py3.11/lib/python3.11/site-packages/pluggy/_callers.py\", line 39, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/.cache/pypoetry/virtualenvs/disney-test-api-taf-A9L5E0vM-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py\", line 1130, in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/.cache/pypoetry/virtualenvs/disney-test-api-taf-A9L5E0vM-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py\", line 909, in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\n                     ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/disney-test-api-taf/disney-test-api-taf/tests/conftest.py\", line 60, in users\n    access_token = get_access_token(client, email, password)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/disney-test-api-taf/disney-test-api-taf/core/auth.py\", line 17, in get_access_token\n    access_token = model.data.access\n                   ^^^^^^^^^^^^^^^^^\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true}],"afterStages":[{"name":"client::0","time":{"start":1700620978536,"stop":1700620978537,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false}],"labels":[{"name":"parentSuite","value":"tests.facility"},{"name":"suite","value":"test_facility"},{"name":"subSuite","value":"TestFacilityAuth"},{"name":"host","value":"fv-az578-664"},{"name":"thread","value":"2402-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.facility.test_facility"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"user","value":"<User.FACILITY_ADMIN: 'facility_admin'>"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"4c34089613ee0761","status":"broken","statusDetails":"AttributeError: 'NoneType' object has no attribute 'access'","time":{"start":1700620846605,"stop":1700620846605,"duration":0}},{"uid":"238e84b1c11f2c4","status":"broken","statusDetails":"AttributeError: 'NoneType' object has no attribute 'access'","time":{"start":1700620846029,"stop":1700620846029,"duration":0}},{"uid":"9ce8d503fd84ca7e","status":"broken","statusDetails":"AttributeError: 'NoneType' object has no attribute 'access'","time":{"start":1700620845447,"stop":1700620845447,"duration":0}}],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":1,"skipped":0,"passed":1,"unknown":0,"total":2},"items":[{"uid":"14478d24131fde20","reportUrl":"https://Rustam-Z.github.io/disney-test-api-taf/193//#testresult/14478d24131fde20","status":"passed","time":{"start":1700534402243,"stop":1700534402277,"duration":34}}]},"tags":[]},"source":"bb4cbba683069f3b.json","parameterValues":["<User.FACILITY_ADMIN: 'facility_admin'>"]}